var _createClass=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var EventBus=function(){function t(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).dispatchToDOM,e=void 0!==e&&e;_classCallCheck(this,t),this._listeners=Object.create(null),this._dispatchToDOM=!0===e}return _createClass(t,[{key:"on",value:function(e,t){var n=this._listeners[e];n||(n=[],this._listeners[e]=n),n.push(t)}},{key:"off",value:function(e,t){var n=this._listeners[e],e=void 0;!n||(e=n.indexOf(t))<0||n.splice(e,1)}},{key:"dispatch",value:function(e){var t,n=this._listeners[e];n&&0!==n.length?(t=Array.prototype.slice.call(arguments,1),n.slice(0).forEach(function(e){e.apply(null,t)}),this._dispatchToDOM&&this._dispatchDOMEvent(e,t)):this._dispatchToDOM&&(n=Array.prototype.slice.call(arguments,1),this._dispatchDOMEvent(e,n))}},{key:"_dispatchDOMEvent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(this._dispatchToDOM){var n=Object.create(null);if(t&&0<t.length){var i,r=t[0];for(i in r){var s=r[i];if("source"!==i)n[i]=s;else if(s===window||s===document)return}}t=document.createEvent("CustomEvent");t.initCustomEvent(e,!0,!0,n),document.dispatchEvent(t)}}}]),t}(),TextLayerBuilder=function(){function a(e){var t=e.textLayerDiv,n=e.eventBus,i=e.pageIndex,r=e.viewport,s=e.findController,s=void 0===s?null:s,e=e.enhanceTextSelection,e=void 0!==e&&e;_classCallCheck(this,a),this.textLayerDiv=t,this.eventBus=n||(0,_dom_events.getGlobalEventBus)(),this.textContent=null,this.textContentItemsStr=[],this.textContentStream=null,this.renderingDone=!1,this.pageIdx=i,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=r,this.textDivs=[],this.findController=s,this.textLayerRenderTask=null,this.enhanceTextSelection=e,this._boundEvents=Object.create(null),this._bindEvents(),this._bindMouse()}return _createClass(a,[{key:"_finishRendering",value:function(){var e;this.renderingDone=!0,this.enhanceTextSelection||((e=document.createElement("div")).className="endOfContent",this.textLayerDiv.appendChild(e)),this.eventBus.dispatch("textlayerrendered",{source:this,pageNumber:this.pageNumber,numTextDivs:this.textDivs.length})}},{key:"render",value:function(){var e,t=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;!this.textContent&&!this.textContentStream||this.renderingDone||(this.cancel(),this.textDivs=[],e=document.createDocumentFragment(),this.textLayerRenderTask=(0,pdfjsLib.renderTextLayer)({textContent:this.textContent,textContentStream:this.textContentStream,container:e,viewport:this.viewport,textDivs:this.textDivs,textContentItemsStr:this.textContentItemsStr,timeout:n,enhanceTextSelection:this.enhanceTextSelection}),this.textLayerRenderTask.promise.then(function(){t.textLayerDiv.appendChild(e),t._finishRendering(),t.updateMatches()},function(e){}))}},{key:"cancel",value:function(){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null)}},{key:"setTextContentStream",value:function(e){this.cancel(),this.textContentStream=e}},{key:"setTextContent",value:function(e){this.cancel(),this.textContent=e}},{key:"convertMatches",value:function(e,t){var n=0,i=0,r=this.textContentItemsStr,s=r.length-1,a=null===this.findController?0:this.findController.state.query.length,o=[];if(!e)return o;for(var l=0,c=e.length;l<c;l++){for(var d=e[l];n!==s&&d>=i+r[n].length;)i+=r[n].length,n++;n===r.length&&console.error("Could not find a matching mapping");var h={begin:{divIdx:n,offset:d-i}};for(d+=t?t[l]:a;n!==s&&d>i+r[n].length;)i+=r[n].length,n++;h.end={divIdx:n,offset:d-i},o.push(h)}return o}},{key:"renderMatches",value:function(e){if(0!==e.length){var s=this.textContentItemsStr,a=this.textDivs,t=null,n=this.pageIdx,i=null!==this.findController&&n===this.findController.selected.pageIdx,r=null===this.findController?-1:this.findController.selected.matchIdx,o={divIdx:-1,offset:void 0},l=r,c=l+1;if(null!==this.findController&&this.findController.state.highlightAll)l=0,c=e.length;else if(!i)return;for(var d=l;d<c;d++){var h=e[d],u=h.begin,f=h.end,v=i&&d===r?" selected":"";if(this.findController&&this.findController.selected.matchIdx===d&&this.findController.selected.pageIdx===n&&(h={top:MATCH_SCROLL_OFFSET_TOP,left:MATCH_SCROLL_OFFSET_LEFT},(0,_ui_utils.scrollIntoView)(a[u.divIdx],h,!0)),t&&u.divIdx===t.divIdx?m(t.divIdx,t.offset,u.offset):(null!==t&&m(t.divIdx,t.offset,o.offset),x(u)),u.divIdx===f.divIdx)m(u.divIdx,u.offset,f.offset,"highlight"+v);else{m(u.divIdx,u.offset,o.offset,"highlight begin"+v);for(var p=u.divIdx+1,g=f.divIdx;p<g;p++)a[p].className="highlight middle"+v;x(f,"highlight end"+v)}t=f}t&&m(t.divIdx,t.offset,o.offset)}function x(e,t){var n=e.divIdx;a[n].textContent="",m(n,0,e.offset,t)}function m(e,t,n,i){var r=a[e],t=s[e].substring(t,n),n=document.createTextNode(t);if(i){t=document.createElement("span");return t.className=i,t.appendChild(n),void r.appendChild(t)}r.appendChild(n)}}},{key:"updateMatches",value:function(){if(this.renderingDone){for(var e,t,n=this.matches,i=this.textDivs,r=this.textContentItemsStr,s=-1,a=0,o=n.length;a<o;a++){for(var l=n[a],c=Math.max(s,l.begin.divIdx),d=l.end.divIdx;c<=d;c++){var h=i[c];h.textContent=r[c],h.className=""}s=l.end.divIdx+1}this.findController&&this.findController.highlightMatches&&(t=e=void 0,null!==this.findController&&(e=this.findController.pageMatches[this.pageIdx]||null,t=this.findController.pageMatchesLength&&this.findController.pageMatchesLength[this.pageIdx]||null),this.matches=this.convertMatches(e,t),this.renderMatches(this.matches))}}},{key:"_bindEvents",value:function(){var n=this,i=this.eventBus,r=this._boundEvents;r.pageCancelled=function(e){if(e.pageNumber===n.pageNumber)if(n.textLayerRenderTask)console.error("TextLayerBuilder._bindEvents: `this.cancel()` should have been called when the page was reset, or rendering cancelled.");else for(var t in r)i.off(t.toLowerCase(),r[t]),delete r[t]},r.updateTextLayerMatches=function(e){e.pageIndex!==n.pageIdx&&-1!==e.pageIndex||n.updateMatches()},i.on("pagecancelled",r.pageCancelled),i.on("updatetextlayermatches",r.updateTextLayerMatches)}},{key:"_bindMouse",value:function(){var i=this,r=this.textLayerDiv,s=null;r.addEventListener("mousedown",function(e){if(i.enhanceTextSelection&&i.textLayerRenderTask)return i.textLayerRenderTask.expandTextDivs(!0),void(s&&(clearTimeout(s),s=null));var t,n=r.querySelector(".endOfContent");n&&(e.target!==r&&"none"!==window.getComputedStyle(n).getPropertyValue("-moz-user-select")&&(t=r.getBoundingClientRect(),t=Math.max(0,(e.pageY-t.top)/t.height),n.style.top=(100*t).toFixed(2)+"%"),n.classList.add("active"))}),r.addEventListener("mouseup",function(){var e;i.enhanceTextSelection&&i.textLayerRenderTask?s=setTimeout(function(){i.textLayerRenderTask&&i.textLayerRenderTask.expandTextDivs(!1),s=null},EXPAND_DIVS_TIMEOUT):(e=r.querySelector(".endOfContent"))&&(e.style.top="",e.classList.remove("active"))})}}]),a}(),PDFLinkService=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.eventBus,n=e.externalLinkTarget,n=void 0===n?null:n,e=e.externalLinkRel,e=void 0===e?null:e;_classCallCheck(this,i),this.eventBus=t||(0,_dom_events.getGlobalEventBus)(),this.externalLinkTarget=n,this.externalLinkRel=e,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null,this._pagesRefCache=null}return _createClass(i,[{key:"setDocument",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.baseUrl=t,this.pdfDocument=e,this._pagesRefCache=Object.create(null)}},{key:"setViewer",value:function(e){this.pdfViewer=e}},{key:"setHistory",value:function(e){this.pdfHistory=e}},{key:"navigateTo",value:function(r){function s(e){var t=e.namedDest,n=e.explicitDest,i=n[0],e=void 0;if(i instanceof Object||"object"==typeof i){if(null===(e=a._cachedPageNumber(i)))return void a.pdfDocument.getPageIndex(i).then(function(e){a.cachePageRef(e+1,i),s({namedDest:t,explicitDest:n})}).catch(function(){console.error('PDFLinkService.navigateTo: "'+i+'" is not a valid page reference, for dest="'+r+'".')})}else{if(!Number.isInteger(i))return void console.error('PDFLinkService.navigateTo: "'+i+'" is not a valid destination reference, for dest="'+r+'".');e=i+1}!e||e<1||e>a.pagesCount?console.error('PDFLinkService.navigateTo: "'+e+'" is not a valid page number, for dest="'+r+'".'):(a.pdfHistory&&(a.pdfHistory.pushCurrentPosition(),a.pdfHistory.push({namedDest:t,explicitDest:n,pageNumber:e})),a.pdfViewer.scrollPageIntoView({pageNumber:e,destArray:n}))}var a=this;new Promise(function(t,e){"string"!=typeof r?t({namedDest:"",explicitDest:r}):a.pdfDocument.getDestination(r).then(function(e){t({namedDest:r,explicitDest:e})})}).then(function(e){Array.isArray(e.explicitDest)?s(e):console.error('PDFLinkService.navigateTo: "'+e.explicitDest+'" is not a valid destination array, for dest="'+r+'".')})}},{key:"goToDestination",value:function(r){function s(e){var t=e.namedDest,n=e.explicitDest,i=n[0],e=void 0;if(i instanceof Object||"object"==typeof i){if(null===(e=a._cachedPageNumber(i)))return void a.pdfDocument.getPageIndex(i).then(function(e){a.cachePageRef(e+1,i),s({namedDest:t,explicitDest:n})}).catch(function(){console.error('PDFLinkService.navigateTo: "'+i+'" is not a valid page reference, for dest="'+r+'".')})}else{if(!Number.isInteger(i))return void console.error('PDFLinkService.navigateTo: "'+i+'" is not a valid destination reference, for dest="'+r+'".');e=i+1}!e||e<1||e>a.pagesCount?console.error('PDFLinkService.navigateTo: "'+e+'" is not a valid page number, for dest="'+r+'".'):(a.pdfHistory&&(a.pdfHistory.pushCurrentPosition(),a.pdfHistory.push({namedDest:t,explicitDest:n,pageNumber:e})),a.pdfViewer.scrollPageIntoView({pageNumber:e,destArray:n}))}var a=this;new Promise(function(t,e){"string"!=typeof r?t({namedDest:"",explicitDest:r}):a.pdfDocument.getDestination(r).then(function(e){t({namedDest:r,explicitDest:e})})}).then(function(e){Array.isArray(e.explicitDest)?s(e):console.error('PDFLinkService.navigateTo: "'+e.explicitDest+'" is not a valid destination array, for dest="'+r+'".')})}},{key:"getDestinationHash",value:function(e){if("string"==typeof e)return this.getAnchorUrl("#"+escape(e));if(Array.isArray(e)){e=JSON.stringify(e);return this.getAnchorUrl("#"+escape(e))}return this.getAnchorUrl("")}},{key:"getAnchorUrl",value:function(e){return(this.baseUrl||"")+e}},{key:"setHash",value:function(e){var t=void 0,n=void 0;if(e.includes("=")){var i,r,s,a=(0,_ui_utils.parseQueryString)(e);"search"in a&&this.eventBus.dispatch("findfromurlhash",{source:this,query:a.search.replace(/"/g,""),phraseSearch:"true"===a.phrase}),"nameddest"in a?this.navigateTo(a.nameddest):("page"in a&&(t=0|a.page||1),"zoom"in a&&(r=(i=a.zoom.split(","))[0],s=parseFloat(r),r.includes("Fit")?"Fit"===r||"FitB"===r?n=[null,{name:r}]:"FitH"===r||"FitBH"===r||"FitV"===r||"FitBV"===r?n=[null,{name:r},1<i.length?0|i[1]:null]:"FitR"===r?5!==i.length?console.error('PDFLinkService.setHash: Not enough parameters for "FitR".'):n=[null,{name:r},0|i[1],0|i[2],0|i[3],0|i[4]]:console.error('PDFLinkService.setHash: "'+r+'" is not a valid zoom value.'):n=[null,{name:"XYZ"},1<i.length?0|i[1]:null,2<i.length?0|i[2]:null,s?s/100:r]),n?this.pdfViewer.scrollPageIntoView({pageNumber:t||this.page,destArray:n,allowNegativeOffset:!0}):t&&(this.page=t),"pagemode"in a&&this.eventBus.dispatch("pagemode",{source:this,mode:a.pagemode}))}else{n=unescape(e);try{n=JSON.parse(n),Array.isArray(n)||(n=n.toString())}catch(e){}"string"==typeof n||isValidExplicitDestination(n)?this.navigateTo(n):console.error('PDFLinkService.setHash: "'+unescape(e)+'" is not a valid destination.')}}},{key:"executeNamedAction",value:function(e){switch(e){case"GoBack":this.pdfHistory&&this.pdfHistory.back();break;case"GoForward":this.pdfHistory&&this.pdfHistory.forward();break;case"NextPage":this.page<this.pagesCount&&this.page++;break;case"PrevPage":1<this.page&&this.page--;break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1}this.eventBus.dispatch("namedaction",{source:this,action:e})}},{key:"cachePageRef",value:function(e,t){t&&(t=t.num+" "+t.gen+" R",this._pagesRefCache[t]=e)}},{key:"_cachedPageNumber",value:function(e){e=e.num+" "+e.gen+" R";return this._pagesRefCache&&this._pagesRefCache[e]||null}},{key:"pagesCount",get:function(){return this.pdfDocument?this.pdfDocument.numPages:0}},{key:"page",get:function(){return this.pdfViewer.currentPageNumber},set:function(e){this.pdfViewer.currentPageNumber=e}},{key:"rotation",get:function(){return this.pdfViewer.pagesRotation},set:function(e){this.pdfViewer.pagesRotation=e}}]),i}();function isValidExplicitDestination(e){if(!Array.isArray(e))return!1;var t=e.length,n=!0;if(t<2)return!1;var i=e[0];if(!("object"===(void 0===i?"undefined":_typeof(i))&&Number.isInteger(i.num)&&Number.isInteger(i.gen)||Number.isInteger(i)&&0<=i))return!1;i=e[1];if("object"!==(void 0===i?"undefined":_typeof(i))||"string"!=typeof i.name)return!1;switch(i.name){case"XYZ":if(5!==t)return!1;break;case"Fit":case"FitB":return 2===t;case"FitH":case"FitBH":case"FitV":case"FitBV":if(3!==t)return!1;break;case"FitR":if(6!==t)return!1;n=!1;break;default:return!1}for(var r=2;r<t;r++){var s=e[r];if(!("number"==typeof s||n&&null===s))return!1}return!0}