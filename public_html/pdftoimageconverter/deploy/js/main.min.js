!function(){function e(e){var t=window.location.href;e=e.replace(/[[\]]/g,"\\$&");t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}var t=e("pdfUrl"),n=e("imageQuality"),a=e("pageHeight"),o=e("thumbnailHeight"),i=e("imageType"),h=document.getElementById("imageQuality"),w=document.getElementById("pageHeight"),E=document.getElementById("thumbnailHeight"),B=document.getElementById("imageType");n&&(h.value=n),a&&(w.value=a),o&&(E.value=o),i&&(B.value=i),document.getElementById("uploadContainer");var d,r=document.getElementById("dropContainer"),i=(document.getElementById("dropMessage"),document.getElementById("browseButton")),C=document.getElementById("progressBar"),x=document.getElementById("progressMessage"),I=document.getElementById("downloadContainer"),L=document.getElementById("downloadButton"),h=document.getElementById("imageQuality"),l=document.getElementById("imageQualityValue"),w=document.getElementById("pageHeight"),E=document.getElementById("thumbnailHeight"),B=document.getElementById("imageType"),c=new EventBus,u=new PDFLinkService({eventBus:c});t&&s(t),h.addEventListener("input",function(){l.textContent=h.value}),i.addEventListener("click",function(e){e.preventDefault(),document.getElementById("pdfFile").click()}),document.getElementById("pdfFile").addEventListener("change",function(e){g(e.target.files[0])}),r.addEventListener("dragenter",function(e){e.preventDefault(),r.classList.add("drag-over")}),r.addEventListener("dragover",function(e){e.preventDefault()}),r.addEventListener("dragleave",function(e){e.preventDefault(),r.classList.remove("drag-over")}),r.addEventListener("drop",function(e){e.preventDefault(),r.classList.remove("drag-over"),g(e.dataTransfer.files[0])}),document.getElementById("convertButton").addEventListener("click",function(){var e=document.getElementById("pdfUrlInput").value;e&&s(e)});async function s(e){p();try{var t=await(await fetch(e)).arrayBuffer(),n=e.substring(e.lastIndexOf("/")+1);g(new File([t],n))}catch(e){console.error("Error loading PDF:",e)}}function b(t,n,a){return new Promise(e=>{"undefined"!=typeof OffscreenCanvas?t.convertToBlob({type:n,quality:a}).then(e):t.toBlob(e,n,a)})}async function g(t){p();var e=new FileReader;e.onloadstart=function(){C.style.width="0%",x.textContent="Uploading PDF..."},e.onprogress=function(e){e.lengthComputable&&(e=e.loaded/e.total*100,C.style.width=e+"%",x.textContent="Uploading PDF: "+Math.round(e)+"%")},e.onload=async function(e){C.style.width="100%",C.classList.add("complete"),x.textContent="PDF uploaded. Converting...",d=new Uint8Array(e.target.result),async function(t){I.style.display="none";var n=new JSZip,a=t.name.replace(".pdf",""),o=n.folder(a),i=await pdfjsLib.getDocument(d).promise,r=i.numPages;C.style.width="0%",x.textContent="Converting PDF: 0%",await i.getPage(1).then(e=>async function t(n,e,a,o,i,r,d,l){var s=P();var c=s.getContext("2d");var u=e.getViewport({scale:1});var g=w.value;var p=g/u.height;var m=u.width/u.height;var v=g*m;s.width=v;s.height=g;u=e.getViewport({scale:p});await e.render({canvasContext:c,viewport:u}).promise;var f=B.value;var y="."+f.split("/")[1];v=h.value;g=await b(s,f,v);a.file(i.toString()+y,g,{type:f});var p=P();var c=p.getContext("2d");var s=E.value;var g=m*s;var m=s/e.getViewport({scale:1}).height;p.width=g;p.height=s;u=e.getViewport({scale:m});await e.render({canvasContext:c,viewport:u}).promise;var v=await b(p,f,v);a.file("thumb"+i.toString()+y,v,{type:f});f=document.createElement("img");f.src=URL.createObjectURL(v);f.classList.add("thumbnail");thumbnailsContainer.appendChild(f);f=document.createElement("div");await D(n,e,f);f=JSON.stringify({data:encodeURIComponent(f.innerHTML)});f=new Blob([f],{type:"application/json"});a.file(i.toString()+".json",f);C.style.width=i/r*100+"%";x.textContent="Converting PDF: "+i.toString()+"/"+r;i++;i<=r?await n.getPage(i).then(e=>t(n,e,a,o,i,r,d,l)):(f=await d.generateAsync({type:"blob"},function(e){var e=e.percent||0;C.style.width=e+"%",x.textContent="Generating ZIP: "+Math.round(e)+"%"}),f=URL.createObjectURL(f),L.setAttribute("download",l.name.replace(".pdf","")+".zip"),L.href=f,I.style.display="block",x.textContent="ZIP generated successfully")}(i,e,o,a,1,r,n,t))}(t)},e.readAsArrayBuffer(t)}function P(){return"undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas")}async function D(a,n,d){const{annotations:e,textContent:t}=await async function(e){var t=e.getAnnotations(),e=e.getTextContent(),[t,e]=await Promise.all([t,e]);return{annotations:t,textContent:e}}(n);d.classList.add("flipbook-page-htmlContent"),d.style.transformOrigin="0 0";const l=[];if(t){const i=document.createElement("div");i.className="flipbook-textLayer",d.appendChild(i);var o=1e3/n.getViewport({scale:1}).height;i.style.width=String(1e3*n.getViewport({scale:1}).width/n.getViewport({scale:1}).height)+"px",i.style.height="1000px";const r=new TextLayerBuilder({eventBus:c,textLayerDiv:i,pageIndex:n._pageIndex,viewport:n.getViewport({scale:o})});o=new Promise(function(t){r.eventBus.on("textlayerrendered",function(e){n.textlayerrendered=!0,t()})});l.push(o),r.setTextContent(t),r.render()}if(0<e.length){const s=document.createElement("div");s.className="annotationLayer",d.appendChild(s);o={viewport:n.getViewport({scale:1e3/n.getViewport({scale:1}).height}).clone({dontFlip:!0}),div:s,annotations:e,page:n,linkService:u};pdfjsLib.AnnotationLayer.render(o),e.forEach(function(e){var o,i,r,t=d.querySelector('[data-annotation-id="'+e.id+'"]'),e=e.dest;if(e&&t){const n=t.firstChild;n&&(n.href="#",o=a,i=e,r=n,e=new Promise(function(a,e){const t="string"==typeof i?o.getDestination(i):Promise.resolve(i);t.then(function(e){if(Array.isArray(e)){var t=e[0];const n=o.getPageIndex(t);n.then(function(e){r.dataset.page=e+1,a()})}else console.error('PDFLinkService.navigateTo: "'+e+'" is not a valid destination array, for dest="'+i+'".')})}),l.push(e))}})}return Promise.all(l)}function p(){I.style.display="none",C.style.width="0%",C.classList.remove("complete"),x.textContent=""}}();